{% extends 'base.html.twig' %}

{% block title %}Home{% endblock %}

{% block body %}
    {% if connected %}
        <h1>Welcome to Habitica,  
        {% if user.profilePicture %}
            <img src="{{ asset('uploads/' ~ user.profilePicture) }}" alt="Photo de profil" width="150"> 
        {% endif %}
        {{ user.username }}!</h1>
        <form action="{{ path('app_logout') }}" method="post">
            <button type="submit" class="btn btn-danger">Logout</button>
        </form>
        <h2>Your Habits</h2>
        {% if userHabits is empty %}
            <p>You still don't have habits.</p>
            <form action="{{ path('add_habit', {'userId': user.id, 'groupId': user.group_id}) }}" method="get">
                <button type="submit" class="btn">Add habit</button>
            </form>
        {% else %}
            <ul>
                {% for habit in user.habits %}
                    <h2>{{ habit.name }}</h2><br>
                    <span>Description: {{ habit.description }}</span><br>
                    <span>Difficulty: {{ habit.difficulty }}</span><br>
                    <span>Periodicity: {{ habit.periodicity }}</span><br>
                    <form action="{{ path('complete_habit', {'userId': user.id, 'habitId': habit.id}) }}" method="post">
                        <input type="hidden" name="completed" value="0">
                        <input type="checkbox" name="completed" value="1" 
                            {% for completedHabit in user.completedHabits %}
                                {% if completedHabit.habitId == habit.id and completedHabit.isCompleted %}
                                    checked
                                {% endif %}
                            {% endfor %}
                            onchange="this.form.submit()">
                        <br>
                    </form>
                    <form method="post" action="{{ path('delete_habit', {'habitId': habit.id}) }}" onsubmit="return confirm('Are you sure you want to delete this habit?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('deleteHabit' ~ habit.id) }}">
                        <button class="btn">Delete Habit</button>
                    </form>
                {% endfor %}
            </ul>
            {% if user.createdHabitToday %}
                <p>You have already created a habit today.</p>
            {% else %}
                <form action="{{ path('add_habit', {'userId': user.id, 'groupId': user.group_id}) }}" method="get">
                    <button type="submit" class="btn">Add habit</button>
                </form>
            {% endif %}
        {% endif %}

        {% if groupHabits is not empty %}
            <h2>Les habitudes de votre groupe</h2>
            <ul>
                {% for habit in groupHabits %}
                    <li>
                        <strong>{{ habit.name }}</strong>: {{ habit.description }}
                        <span style="color: {{ habit.color }};">â¬¤</span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Votre groupe n'a pas encore d'habitudes.</p>
        {% endif %}
    {% else %}
        <h1>Welcome to Habitica!</h1>
        <a href="{{ path('app_login') }}" class="btn btn-primary">Login</a>

        <h2>Existing users</h2>
        {% for user in users %}
            <p>
                <img src="{{ asset('uploads/' ~ user.profilePicture) }}" alt="Photo de profil" width="150">
                <b>Username :</b> {{ user.username }}<br>
                <b>Points :</b> {{ user.points }}<br>
                <b>Group: </b> {{ user.group_id }}<br>
                <b>Habits:</b><br>
                {% for habit in user.habits %}
                    <span>{{ habit.name }}</span><br>
                {% endfor %}
            </p>
        {% endfor %}
    {% endif %}
{% endblock %}