{# templates/habitica/index.html.twig #}
{% extends 'base.html.twig' %}
{% block title %}
    <h1>Welcome to Habitica!</h1>
{% endblock %}
{% block body %}
    <h1>Welcome to Habitica!</h1>
    <h2>Add a new user</h2>
    {{ form_start(form) }}
        {{ form_row(form.first_name) }}
        {{ form_row(form.last_name) }}
        {{ form_row(form.username) }}
        {{ form_row(form.email) }}
        {{ form_row(form.password) }}
        {{ form_row(form.profile_picture) }}
        {{ form_row(form.save) }}
    {{ form_end(form) }}

    <h3>Connected User</h2>
    {% if user.username %}
        <b>Username :</b> {{user.username}}
    {% endif %}
    <h2>Existing users</h2>
    {% for user in users %}
        <p>
            <span style="color:deeppink;"><b>First name: </b>{{ user.first_name }}</span><br>
            <b>UserId :</b> {{user.id}}<br>
            <b>Last name :</b> {{ user.last_name }}<br>
            <b>Username :</b> {{ user.username }}<br>
            <b>Email :</b> {{ user.email }}<br>
            <b>Points :</b> {{ user.points }}<br>
            <b>Picture : </b> {{user.profile_picture}}<br>
            {% if user.group %}
                <b>Groupe : </b> {{user.group.id}}<br>
            {% endif %}
            {#
            <b>Habits :</b><br>
            {% for habit in user.habits %}
                <span style="color:blue;">{{ habit.name }}</span><br>
                <span style="color:blue;">{{ habit.description }}</span><br>
                <span style="color:blue;">{{ habit.difficulty }}</span><br>
                <span style="color:blue;">{{ habit.periodicity }}</span><br>
                <form action="{{ path('complete_habit', {'userId': user.id, 'habitId': habit.id}) }}" method="post">
                    <input type="hidden" name="completed" value="0">
                    <input type="checkbox" name="completed" value="1" {% if habit.id in user.completedHabits %}checked{% endif %} onchange="this.form.submit()"><br>
                </form>
                <form method="post" action="{{ path('delete_habit', {'habitId': habit.id}) }}" onsubmit="return confirm('Are you sure you want to delete this habit?');">
                    <input type="hidden" name="_token" value="{{ csrf_token('deleteHabit' ~ habit.id) }}">
                    <button class="btn">Delete Habit</button>
                </form>
            {% endfor %}
            {% if user.group %}
            <form action="{{ path('add_habit', {'userId': user.id, 'groupId': user.group.id}) }}" method="get">
                <button type="submit" class="btn">Add habit</button>
            </form>
            {% else %}
            <form action="{{ path('add_habit', {'userId': user.id, 'groupId':null}) }}" method="get">
                <button type="submit" class="btn">Add habit</button>
            </form>
            {% endif %}
            
            <form method="post" action="{{ path('user_delete', {'id': user.id}) }}" onsubmit="return confirm('Are you sure you want to delete this user?');">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
                <button class="btn">Delete</button>
            </form>
            #}
        </p>

    {% endfor %}
    {% for log in logs %}
        <p>{{log.timestamp|date('Y-m-d h:i:s')}}
    {% endfor %}
    {% for invit in invits %}
        <p>Sender :{{invit.sender.username}} </p>
        <p>Receiver :{{invit.receiver.username}} </p>
    {% endfor %}
{% endblock %}